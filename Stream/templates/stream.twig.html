{#<!--
Gibbon, Flexible & Open School System
Copyright (C) 2010, Ross Parker

This is a Gibbon template file, written in HTML and Twig syntax.
For info about editing, see: https://twig.symfony.com/doc/2.x/
-->#}

{% if categories %}
<div class="flex rounded-t border border-b-6 bg-white">
    
    {% for category in categories %}

    <a class="relative block px-8 py-5 text-gray-700 hover:text-blue-700 hover:bg-gray-100" href="{{ absoluteURL }}/index.php?q=/modules/Stream/stream.php{{ category.streamCategoryID > 0 ? '&category='~category.name~'&streamCategoryID='~category.streamCategoryID }}">
        <div class="relative mt-1 text-base font-bold uppercase">
            {{ category.name }}

            {%if category.recentPosts > 0 and currentCategory.streamCategoryID != category.streamCategoryID %}
                <span class="badge text-xxs -mr-5 -mt-4 right-0">{{ category.recentPosts }}</span>
            {% endif %}
        </div>

        {% if currentCategory.streamCategoryID == category.streamCategoryID or (currentCategory is empty and category.streamCategoryID == 0) %}
            <div class="absolute bottom-0 border-transparent" style="left: 50%; margin: 15px 0 0 -9px; border-width: 9px; border-bottom-color: #d2d0d0;"></div>
        {% endif %}
    </a>
    {% endfor %}
</div>
{% endif %}

{% if stream %}
    <div class="rounded-b border overflow-hidden">
    {% for post in stream %}
        <div class="flex bg-white p-4 sm:px-4 sm:py-5 font-sans {{ not loop.last ? 'border-b' }}">

            <aside class="w-10 sm:w-12 mr-3 ">
                <a class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-200 overflow-hidden flex items-start justify-center" href="{{ absoluteURL }}/index.php?q=/modules/Stream/stream.php&user={{ post.username }}">
                    <img class="w-full" src="{{ absoluteURL }}/{{ post.image_240 }}" onerror="this.src='{{ absoluteURL }}/themes/{{ gibbonThemeName }}/img/anonymous_125.jpg'" />
                </a>
            </aside>

            <section class="w-full">
                <header class="-mt-px mb-2 text-sm leading-none">
                    <a class="font-semibold no-underline text-gray-800" href="{{ absoluteURL }}/index.php?q=/modules/Stream/stream.php&user={{ post.username }}">{{ formatUsing('name', post.title, post.preferredName, post.surname, 'Staff', false, true) }}</a>
                     Â· 
                    <span class="text-gray-600">{{ formatUsing('relativeTime', post.timestamp) }}</span>

                    {% if currentCategory is not empty and post.timestamp > currentCategory.timestamp %}
                        <span class="tag selected ml-2">{{ __('New') }}</span>
                    {% endif %}
                </header>

                <div class="text-gray-700 leading-tight text-sm sm:text-base mr-3">
                    {{ post.post|raw }}
                </div>

                {% if post.attachments %}
                    <div class="image-container flex flex-wrap justify-start  mt-2 -m-1">
                    {% for attachment in post.attachments %}
                        <figure class="{{ loop.length % 3 == 0 ? 'w-1/3 h-24 sm:h-48' : loop.length % 2 == 1 and loop.index == 1 ? 'w-full h-32 sm:h-64' : 'w-1/2 h-24 sm:h-48' }} p-1" style="line-height: 0;">
                        {% if attachment.type == 'Image' %}
                            <a class="block w-full h-full rounded-sm overflow-hidden bg-no-repeat bg-cover bg-center" href="{{ absoluteURL }}/{{ attachment.attachment }}" data-caption="{{ post.post|striptags }}" style="background-image:url('{{ absoluteURL }}/{{ attachment.thumbnail }}')">
                            </a>
                        {% endif %}
                        </figure>
                    {% endfor %}

                    </div>
                {% endif %}

                <footer></footer>
            </section>
            
        </div>
    {% endfor %}
    </div>
{% else %}
<div class="h-48 rounded-b border bg-gray-100 shadow-inner overflow-hidden flex items-center justify-center">
    <span class="text-gray-600 text-lg">{{ __('There are no posts here yet.') }}</span>
</div>
{% endif%}
